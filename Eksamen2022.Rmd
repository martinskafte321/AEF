---
title: "Exam2022"
author: "tfd199, lhb642, tgx333"
date: "6/11/2022"
output: pdf_document
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(readr)
library(RSQLite)
library(tidyverse)
library(tidymodels) 
library(furrr) 
library(glmnet)
library(broom)
library(timetk)
library(scales)
library(lubridate)
library(scales)
library(frenchdata)
library(caret)
library(ggplot2)
library(ggpubr)
library(kableExtra)
library(mltools)
library(data.table)
library(vtable)
library(keras)
library(quadprog)
library(rmgarch)
library(xts)
```


### 1.
**Use the data until December 31, 2015 to estimate the parameters of the Fama French 3-factor model.**
We load in the csv file. First we filter the data so that we have until (and including) December 31st 2015. Next, we loop through each permno to perform the regression to estimate the parameters of the Fama-French 3 factor model. 
```{r}
#Loading in the CSV file
data <- read_csv("data/data_exam2022.csv") %>%
  filter(month < "2016-01-01") %>% drop_na()

#Estimation:
#Creating matrix to store coefficient values
coefficients <- matrix(NA,
                             nrow = nrow(unique(data['permno'])),
                             ncol = 5) 

colnames(coefficients) = c("Permno","Alpha","beta_M","beta_smb","beta_hml")

for (i in 1:8) { #Looping through permnos
  
  
  t =  unique(data['permno'])[i,]
  coefficients[i,2:5] <- lm(ret_excess ~ mkt_excess + smb + hml, 
     data = data %>% filter(permno == t[[1]] )) %>% coefficients()
  
  coefficients[i,1] <- t[[1]]
}

#Creating table to portray results
coefficients %>% kbl(caption = "Table 1: Summary of Fama-French 3 Factor model regression coefficients",digits = 4) %>%
  kable_classic(full_width = F, html_font = "Cambria")

```
**Give a brief interpretation of the values.**
The above table shows the estimated alpha along with variable coefficients for all variables in the 3 factor model. Alpha can be interpreted as the intercept, i.e. the return in excess of the expected return, conditional on the variables included in the model. The beta values are the regression coefficients for the included variables and shows how much of the expected excess return of asset i that is explained by the market excess return, the small minus big and high minus low factor returns respectively. 

**Derive the model-implied expected gross excess return and the model-implied variance covariance matrix.**
```{r}
data %>%
  filter(permno == '10026') %>%
  replace(is.na(.), 0) %>%
  mutate(impexpret = 0.0102 + 0.5632 * mkt_excess + 0.5944 * smb + 0.4427 * hml)

#else if(permno == '10032'){0.0052 + }
```

